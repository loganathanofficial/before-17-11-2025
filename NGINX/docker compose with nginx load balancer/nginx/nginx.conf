# loadbalancer-project/nginx/nginx.conf (Final Corrected Structure)

# NO 'http {' or 'events {' blocks here! They are already in the main Nginx config.

# Define the group of backend servers. This is placed inside the main http context.
upstream backend_servers {
    # 'app' is the service name from docker-compose.yml
    # '8080' is the port the app listens on internally (matches the Dockerfile EXPOSE)
    server app:8080;
    server app:8080;
    server app:8080;
    
    # Optional: Use a specific algorithm, e.g., least_conn;
}

# The main server block that listens for incoming connections
server {
    # Nginx listens on port 80 inside its container
    listen 80;

    location / {
        # Proxy the request to the backend_servers group
        proxy_pass http://backend_servers;

        # Set headers for better logging/request tracing
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}