# User: Load Balancer Configuration
# Backend Servers: localhost:700, localhost:9000, localhost:10000

# WARNING: The 'user' directive is not supported on Windows. We comment it out.
# user  nginx; 
worker_processes  auto; # Use 'auto' or the number of CPU cores

# Correcting log file paths to be relative (or use a simple absolute path like C:/nginx/logs/...)
error_log  logs/error.log warn;
pid        logs/nginx.pid;


events {
    worker_connections  1024;
}

http {
    # ðŸ”´ CRITICAL FIX for Windows: Changed to 'mime.types' (it's in the 'conf' folder)
    include         mime.types; 
    default_type    application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    # Corrected access log path for Windows
    access_log  logs/access.log  main;

    sendfile          on;
    #tcp_nopush       on;

    keepalive_timeout  65;

    #gzip  on;
    
    # ==============================================================
    # 1. UPSTREAM DEFINITION (The Pool of Backend Servers)
    # ==============================================================
    upstream my_backend_servers {
        # These ports MUST be running your applications
        server localhost:700;
        server localhost:9000;
        server localhost:10000;
        
        # Optional: Uncomment below for Least Connected method
        # least_conn; 
        
        # Optional: Uncomment below for IP Hash (Sticky Sessions)
        # ip_hash; 
    }

    # ==============================================================
    # 2. SERVER BLOCK (Listening for Incoming Traffic on Port 80)
    # ==============================================================
    server {
        listen        80;
        server_name   localhost; # Or your actual domain name

        location / {
            # âœ… CORRECT: Direct traffic to the upstream group for load balancing
            proxy_pass http://my_backend_servers;
            
            # Standard headers to pass client info to the backend
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Optional blocks...
    }
}